# Authentication, Authorization

인증이란 유저가 누구인지 확인하는 절차, 회원가입하고 로그인하는 것을 말하고 인가란 유저에 대한 권한은 허락하는 것을 말한다. 또한 인증과 인가는 API에서 가장 자주 구현되는 기능 중 하나이다.

**그렇다면 인증/인가 는 왜 필요한 것일까?**

- 우리 서비스를 누가, 언제, 어떻게 쓰고 있는가를 파악하기 위해

**그렇다면 인증에는 무엇이 필요할까?**

- 아이디, 이메일 주소, 비밀번호 등이 있다
- Private한 API는 물론이고 Public한 API도 기본적인 인증과 인가를 요구한다.

**인증(Authentication)**

인증은 유저의 identification(신분)을 확인하는 절차이며 쉽게 설명하면 유저의 아이디와 비번을 확인하는 절차이다. 따라서 인증을 하기 위해서는 먼저 유저의 아이디와 비번을 생성할 수 있는 기능도 필요하다.

**비밀번호 암호화**

- 유저의 비밀번호는 절대 비밀번호 그대로 DB에 저장하지 않는다.
    - DB가 해킹당하면 유저의 비밀번호도 그대로 노출될 뿐더러 내부 개발자나 인력이 그 정보를 볼 수 있다. 따라서 유저의 비밀번호는 꼭 암호화해서 저장해야한다.
- 비밀번호 암호화에는 단방향 해쉬 함수(one-way-hash function)가 일반적으로 쓰인다.
    - **단방향 해쉬함수란** 원본 메시지를 변환하여 암호화된 메시지인 Digest를 생성하는 것이다.

**Bcrypt**

- Salting & Key Streching 대표적 라이브러리이며 brypt는 앞서 말한 개념들을 실제로 적용하기 편하게 해주는 대표적인 라이브러리이다.

**단방향 해시함수의 취약점(Rainbow table attack)**

- 해쉬함수는 원래 패스워드를 저장하기 위한 것이 아닌 짧은 시간에 데이터를 검색하기 위해 설계된 것이다.
    - 그렇기 때문에 해시 함수는 본래 처리 속도가 최대한 빠르도록 설계된 속성을 이용해서 공격자는 매우 빠른 속도로 임의의 문자열의 Digest와 해킹할 대상의 Digest를 비교가능하다.

이런방식으로 패스워드를 추측하면 패스워드가 충분히 길거나 복잡하지 않은 경우에는 그리 긴 시간이 걸리지 않는다.

- Rainbow table은 미리 해쉬값들을 계산해 놓은 테이블이다.

**단방향 해쉬함수의 단점 보완(Saltiog, Key Stretching)**

- Salting은 원본 값에 '소금을 뿌리듯이' random 값을 추가하는 것이다.
- Key Stretching은 연산을 느리게 하기 위해 해쉬값이 구해지면 그 해시값을 기반으로 또 해쉬를 하고 또 해쉬를 n번 하여 최종값을 저장한다. 이로인해 Rainbow attack이 어려워진다.

**인가(Authorization)**

사용자가 로그인하면, 해당 사용자가 맞는지 확인하는 절차이다.

- `JSON WEB TOKEN(JWT)`을 쓰면 인가가 수월하다. (서버가 유저 정보를 갖고 있으므로 데이터에서 유저의 권한 정보도 읽어들이면 된다.)
- `access token` 을 통해 해당 유저 정보를 얻을 수 있으므로 해당 유저가 가지고 있는 권한(permission)도 확인가능하다.

**Authorization 절차**

1. Authentication 절차를 통해 `access token`을 생성한다. access token에는 유저 정보를 확인할 수 있는 정보가 들어가 있어야한다. (예를 들어 user id)
2. 유저가 request를 보낼때 `access token` 을 첨부해서 보낸다.
3. 서버에서는 유저가 보낸 `access token` 을 복호화한다.
4. 복호화된 데이터를 통해 user id를 얻는다.
5. user id를 사용해서 database에서 해당 유저의 권한을 확인한다.
6. 유저가 충분한 권한을 가지고 있으면 해당 요청을 처리한다.
7. 유저가 권한을 가지고 있지 않으면 Unauthorized Response(401) 혹은 다른 에러 코드를 보낸다.